// media.js v2.3.0 Copyright (C) 2013-2020 Visman (mio.visman@yandex.ru)
if("undefined"===typeof FluxBB||!FluxBB)var FluxBB={};
FluxBB.media=function(n,D,E){function w(b,g,e){try{var a=new XMLHttpRequest}catch(d){return}a.open("GET",b,!0);a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status){var d=a.responseText;if("string"===typeof d)try{d=JSON.parse(d)}catch(f){e&&e(f);return}"width"in d&&"height"in d&&"html"in d?g&&g(d):e&&e(d)}else e&&e(a)};a.send()}function x(b,g,e){var a,d="",f=n.createElement(b);if(f.canPlayType){for(a=0;a<g.length;a++)""!==f.canPlayType(b+"/"+e[a])&&(u[g[a]]=b+"/"+e[a],d+=(d?"|":"")+g[a]);return d?new RegExp("^([^\\\\\\?\\s<>\"'&]+\\.)("+d+")$","i"):!1}return!1}function q(b,g,e,a,d){e=e||{};a=a||{};var f,c="video"===g||"audio"===g;g=n.createElement(g);for(var k in e)e.hasOwnProperty(k)&&("style"==k?g.style.cssText=e[k]:g.setAttribute(k,e[k]));c&&(f=n.createElement("source"));for(k in a)a.hasOwnProperty(k)&&(c?f.setAttribute(k,a[k]):(f=n.createElement("param"),f.setAttribute("name",k),f.setAttribute("value",a[k]),g.appendChild(f)));c&&g.appendChild(f);if(!d)return b.appendChild(g);e=b.parentNode;return(b=b.nextSibling)?e.insertBefore(g,b):e.appendChild(g)}function r(b){return 0===b%1&&9<b?2:"string"===typeof b&&/^(?:100|[1-9]\d(?:\.\d{1,2})?)%$/.test(b)?1:0}function h(b,g,e){if(g.i){var a="i";var d="iframe"}else if(g.v)a="v",d="video";else if(g.a)a="a",d="audio";else return!1;var f=g[a][0];g=g[a][1]||{};"i"===a&&(f.frameborder="0",f.scrolling="no",f.allowfullscreen||(f.allowfullscreen="allowfullscreen"));e=e||{};e.wt=e.wt||640;e.ht=e.ht||360;a=r(e.wt);var c=r(e.ht);if(1===a&&2===c)f.style="width:100%;height:"+e.ht+"px;",a={style:"padding-top:5px;overflow:hidden;position:relative;width:"+e.wt+";"},e={style:"height:"+e.ht+"px;overflow:hidden;position:relative;"};else if(0<a&&0<c)f.style="position:absolute;left:0;top:0;width:100%;height:100%;",a={style:"padding-top:5px;overflow:hidden;position:relative;"+(1===a?"width:"+e.wt+";":"max-width:"+e.wt+"px;")},e={style:"overflow:hidden;position:relative;height:0;padding-bottom:"+(1===c?e.ht:100*e.ht/e.wt+"%;")};else return!1;++t;f.id="mediajs"+t;b.classList.add("mediajslink");b=q(q(b,"div",a,{},!0),"div",e);y?(b.classList.add("mediajslazy"),b.setAttribute("data-lazyid",t),z[t]={type:d,attr:f,param:g},v||(v=new IntersectionObserver(function(k,p){k.forEach(function(m){if(m.isIntersecting){m=m.target;var l=z[m.dataset.lazyid];q(m,l.type,l.attr,l.param);m.classList.remove("mediajslazy");p.unobserve(m)}})})),v.observe(b)):q(b,d,f,g);return!0}function F(b){return/^\d+$/.test(b)?b:(b=b.match(/^((\d{1,2})h)?((\d{1,2})m)?((\d{1,2})s)?$/))?3600*(b[2]||0)+60*(b[4]||0)+1*(b[6]||0):""}function G(b,g){"z"!=g&&(b=Math.log(704E5/b)/Math.log(2));return Math.min(18,Math.max(Math.round(b),3))}function H(b){function g(l,A,I){h(l,{i:[{src:"https://w.soundcloud.com/player/?sharing=false&liking=false&show_playcount=false&show_comments=false&url=https%3A//"+A}]},I||{wt:"100%",ht:/\/playlists\//.test(A)?450:166})}var e=b.href,a=e.match(/^(.+)(?:#|%23)(\d+(?:\.\d{1,2})?)(%|%25)?(?::|%3A)(\d+(?:\.\d{1,2})?)(%|%25)?$/),d;if(a){b.href=e=a[1];var f=a[2]+(a[3]?"%":"");var c=a[4]+(a[5]?"%":"");0<r(f)&&0<r(c)&&(d={wt:f,ht:c})}(a=e.split("re.php?u="))&&a[1]&&(e=decodeURIComponent(a[1]).replace(/(https?|ftp)___/g,"$1://"));e=e.replace(/&amp;/g,"&");if(f=e.match(/^(https?:\/\/)(www\.)?(.+)$/))if(c=f[3],f[4]="https:"==n.location.protocol?"https://":f[1],a=c.match(/^(?:[a-z\d-]+\.)?youtu(?:be(?:-nocookie)?\.com|\.be)\/(?:playlist|(?:(?:.*?[\?&]v=)?([\w-]{11})(?:\?|&|#|$)))/)){var k=["wmode=transparent"],p=[];e="https://www.youtube.com/embed";if(a[1]){e+="/"+a[1];var m="start t end list rel loop".split(" ")}else k.push("listType=playlist"),m=["list","index","loop"],p=["list"];for(f=c.split(/[\?&#]/);c=f.shift();)c=c.split("="),c[0]&&c[1]&&-1<m.indexOf(c[0])&&/^[\w-]+$/.test(c[1])&&("start"==c[0]||"t"==c[0]||"end"==c[0]?k.push(("end"==c[0]?"end":"start")+"="+F(c[1])):(k.push(c[0]+"="+c[1]),"loop"==c[0]&&"1"==c[1]&&a[1]&&k.push("playlist="+a[1])),c=p.indexOf(c[0]),-1<c&&p.splice(c,1));p.length||h(b,{i:[{src:e+"?"+k.join("&")}]},d)}else(a=c.match(/^(?:player\.)?vimeo\.com\/(?:video\/)?(\d+)/))?h(b,{i:[{src:f[4]+"player.vimeo.com/video/"+a[1]}]},d):(a=c.match(/^dai(?:lymotion\.com\/video|\.ly)\/([a-zA-Z\d]+)/))?h(b,{i:[{src:f[4]+"www.dailymotion.com/embed/video/"+a[1]+'?theme=none"'}]},d):(a=c.match(/^(?:rutube\.ru\/video\/embed|video\.rutube\.ru)\/(\d+)/))?h(b,{i:[{src:f[4]+"rutube.ru/video/embed/"+a[1]}]},d):(a=c.match(/^rutube\.ru\/video\/([a-zA-Z\d]+)/))?h(b,{i:[{src:f[4]+"rutube.ru/video/embed/"+a[1]}]},d):(a=c.match(/^api\.soundcloud\.com\/(?:tracks|playlists)\/\d+/))?g(b,a[0],d):(a=c.match(/^soundcloud\.com\/[\w-]+\/(?:sets\/)?[\w-]+/))?w("https://soundcloud.com/oembed?format=json&url=https%3A//"+a[0],function(l){(l.m=l.html.replace(/%2F/g,"/").match(/api\.soundcloud\.com\/(?:tracks|playlists)\/\d+/))&&g(b,l.m[0],d)}):(a=c.match(/^(www\d+)\.zippyshare\.com\/v\/(\w+)\//))?h(b,{i:[{src:f[4]+"api.zippyshare.com/api/jplayer_embed.jsp?key="+a[2]+"&server="+a[1]+"&width=100%"}]},d||{wt:"100%",ht:92}):(a=c.match(/^metacafe\.com\/(?:watch|embed)\/(\d+)/))?h(b,{i:[{src:"http://www.metacafe.com/embed/"+a[1]+"/"}]},d):(a=c.match(/^video\.sibnet\.ru\/[^\?&]*?video(\d+)/))?h(b,{i:[{src:f[4]+"video.sibnet.ru/shell.php?videoid="+a[1]+"/"}]},d):(a=c.match(/^promodj\.com\/(?:[^\/]+\/[^\/]+|download|embed)\/(\d+)/))?h(b,{i:[{src:f[4]+"promodj.com/embed/"+a[1]+"/big"}]},d||{wt:"100%",ht:70}):(a=c.match(/^(?:[a-z]{1,3}\.)?(ign\.com\/videos\/\d{4}\/\d{1,2}\/\d{1,2}\/[\w-]+)/))?h(b,{i:[{src:f[4]+"widgets.ign.com/video/embed/content.html?url=https://www."+a[1]}]},d):(a=c.match(/^([a-z]{1,}\.)?gamespot\.com\/(?:video(?:s|embed)?|[\w\/-]+\/videos?)(?=\/)[^\?&#]*[\/-](\d{7,})\//))?(c=c.split("?"),c=c[1]?c[1].replace(/&?autoplay=[^&]*/g,"").replace(/^&/,""):!1,h(b,{i:[{src:"https://www.gamespot.com/videos/embed/"+a[2]+"/"+(c?"?"+c:"")}]},d)):B&&(a=c.match(B))?h(b,{a:[{controls:!0,preload:"metadata",controlsList:"nodownload"},{src:f[1]+(f[2]?f[2]:"")+a[1]+a[2],type:u[a[2]]}]},d||{wt:"100%",ht:50}):C&&(a=c.match(C))?h(b,{v:[{controls:!0,preload:"metadata",controlsList:"nodownload"},{src:f[1]+(f[2]?f[2]:"")+a[1]+a[2],type:u[a[2]]}]},d):(a=c.match(/^hu(?:\.lk\/|lkshare\.com\/(?:.*?fn=)?)([a-z\d]{12})(?:$|[^a-z\d])/))?h(b,{i:[{src:f[4]+"www.hulkshare.com/embed.php?fn="+a[1]}]},d||{wt:"100%",ht:160}):(a=c.match(/^(mixcloud\.com\/(?!(categories|competitions|projects|developers|tag)\/)[\w-]+\/(?!(listens|favorites|activity|messages|following)\/)[\w-]+\/)$/))?h(b,{i:[{src:f[4]+"www.mixcloud.com/widget/iframe/?hide_artwork=1&embed_type=widget_standard&hide_tracklist=1&feed=http://www."+a[1]}]},d||{wt:"100%",ht:120}):(a=c.match(/^(vk\.com\/video_ext\.php\?oid=[\d-]+&id=[\d-]+&hash=\w+(&sd|&hd=1|&hd=2)?)/))?h(b,{i:[{src:f[4]+a[1]}]},d):(a=c.match(/^coub\.com\/view\/([a-zA-Z\d]+)/))?h(b,{i:[{src:f[4]+"coub.com/embed/"+a[1]+"?muted=false&autostart=false&originalSize=false"}]},d):(a=c.match(/^vine\.co\/v\/([a-zA-Z\d]+)/))?h(b,{i:[{src:"https://vine.co/v/"+a[1]+"/embed/simple"}]},d||{wt:360,ht:360}):(a=c.match(/^(?:[a-z\d-]+\.)?facebook\.com.*?\/(?:photo\.php|video\.php|embed|videos\/(?:vb\.\d+\/)?)(?:.*?[\?&]v(?:ideo_id)?=)?(\d+)(?=\/|&|$)/))?h(b,{i:[{src:"https://www.facebook.com/video/embed?video_id="+a[1]}]},d):(a=c.match(/^(?=[^\/]*\byandex\.(com|ru|ua)\/)(?=[^\?&]*\bmaps\b).+\/\-\/([\w~\-]+)$/))?h(b,{i:[{src:"https://api-maps.yandex."+a[1]+"/frame/v1/-/"+a[2]}]},d||{wt:410,ht:350}):(a=c.match(/^maps\.google\.((?:com?\.)?[a-z]{2,3})\/([a-z\d\?\.,&=]+)$/))?h(b,{i:[{src:("cn"==a[1]?"http://maps.google."+a[1]:"https://maps.google.com")+"/"+a[2]+"&ie=UTF8&output=embed"}]},d||{wt:410,ht:350}):(a=c.match(/^google\.((?:com?\.)?[a-z]{2,3})\/maps\/embed\?pb=([^\s\?<>,&]+)$/))?h(b,{i:[{src:("cn"==a[1]?"http://www.google."+a[1]:"https://www.google.com")+"/maps/embed?pb="+a[2]}]},d||{wt:410,ht:350}):(a=c.match(/^google\.((?:com?\.)?[a-z]{2,3})\/maps\/(?:place\/([^\/<>\[\]\?&]+))?[^\?&]*@(-?\d+\.\d+),(-?\d+\.\d+),(\d+(?:\.\d+)?)([zm])/))?h(b,{i:[{src:("cn"==a[1]?"http://maps.google."+a[1]:"https://maps.google.com")+"/?ll="+a[3]+","+a[4]+"&t="+("z"==a[6]?"m":"h")+"&z="+G(a[5],a[6])+(a[2]?"&q="+a[2]:"")+"&ie=UTF8&output=embed"}]},d||{wt:410,ht:350}):(a=c.match(/^ok\.ru\/video(?:embed)?\/(\d+)/))?h(b,{i:[{src:"https://ok.ru/videoembed/"+a[1]}]},d):(a=c.match(/^liveleak\.com\/(?:view|ll_embed)\?([a-z])=(\w+)/))?h(b,{i:[{src:f[4]+"www.liveleak.com/ll_embed?"+a[1]+"="+a[2]}]},d):(a=c.match(/^video\.online\.ua\/(?:embed\/)?(\d+)\//))?h(b,{i:[{src:f[4]+"video.online.ua/embed/"+a[1]+"/"}]},d):(a=c.match(/^aparat\.com\/(?:v|embed)\/(\w+)/))?h(b,{i:[{src:"https://www.aparat.com/video/video/embed/videohash/"+a[1]+"/vt/frame"}]},d):(a=c.match(/^audiomack\.com\/(?:embed\/)?song\/([\w-]+\/[\w-]+)/))?h(b,{i:[{src:"https://audiomack.com/embed/song/"+a[1]+"?background=1"}]},d||{wt:"100%",ht:252}):(a=c.match(/^audiomack\.com\/(?:embed\/)?playlist\/([\w-]+\/[\w-]+)/))?h(b,{i:[{src:"https://audiomack.com/embed/playlist/"+a[1]+"?background=1"}]},d||{wt:"100%",ht:400}):(a=c.match(/^dumpert\.nl\/(?:mediabase|embed)(\/\d+\/[\dabcdef]+\/)/))?h(b,{i:[{src:"https://www.dumpert.nl/embed"+a[1]}]},d):(a=c.match(/^izlesene\.com\/(?:embedplayer|video\/[^\/]+)\/(\d+)/))?h(b,{i:[{src:"https://www.izlesene.com/embedplayer/"+a[1]+"/?showrel=0&loop=0&autoplay=0&autohide=1&showinfo=1&socialbuttons=1&annotation=&volume=0.5"}]},d):(a=c.match(/^hearthis\.at\/(?!(?:categories|maps)\/)[\w\.-]+\/(?:set\/)?[\w\.-]+\//))?w("https://hearthis.at/oembed/?format=json&url=https%3A//"+a[0],function(l){(l.m=l.html.match(/<iframe [^>]*?src=["']([^"'<>]+)["']/))&&h(b,{i:[{src:l.m[1]}]},d||{wt:l.width,ht:l.height})}):(a=c.match(/^(?:vlp\.to\/|vlipsy\.com\/(?:vlip\/[\w-]+-|embed\/))([a-zA-Z\d]{8})$/))&&h(b,{i:[{src:"https://vlipsy.com/embed/"+a[1]}]},d)}var t=0,u={},B=x("audio","mp3 m4a ogg oga webma wav flac".split(" "),"mpeg mp4 ogg ogg webm wav flac".split(" ")),C=x("video",["mp4","m4v","ogv","webm","webmv"],["mp4","mp4","ogg","webm","webm"]),y=!1,z=[],v;return{run:function(){var b;if(!(b=n.querySelectorAll("#brd-main .entry-content"))||!b.length)if(!(b=n.querySelectorAll(".postmsg"))||!b.length)return;"IntersectionObserver"in D&&!/Googlebot|YandexBot/.test(E.userAgent)&&(y=!0);for(var g in b)if(b[g].className&&!b[g].classList.contains("postsignature")){var e=b[g].getElementsByTagName("a"),a;for(a in e)if(e[a].href&&(!e[a].nextSibling||e[a].nextSibling.tagName&&"BR"==e[a].nextSibling.tagName.toUpperCase())&&(!e[a].previousSibling||e[a].previousSibling.tagName&&"BR"==e[a].previousSibling.tagName.toUpperCase())&&"P"==e[a].parentNode.tagName.toUpperCase()&&!/<(p|a|img|ul|ol)/i.test(e[a].innerHTML)){for(var d=e[a].parentNode;d!==b[g]&&"BLOCKQUOTE"!==d.tagName.toUpperCase();)d=d.parentNode;d===b[g]&&H(e[a])}}},init:function(){n.addEventListener&&"undefined"!==typeof DOMTokenList&&n.addEventListener("DOMContentLoaded",FluxBB.media.run(),!1)}}}(document,window,navigator);FluxBB.media.init();
