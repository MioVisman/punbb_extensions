// media.js v2.2.0 Copyright (C) 2013-2019 Visman (mio.visman@yandex.ru)
if("undefined"===typeof FluxBB||!FluxBB)var FluxBB={};FluxBB.media=function(m,u,l){function v(b,h,f){try{var a=new XMLHttpRequest}catch(d){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(g){f&&f(g);return}}a.open("GET",b,!0);a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status){var b=a.responseText;if("string"===typeof b)try{b=JSON.parse(b)}catch(g){f&&f(g);return}"width"in b&&"height"in b&&"html"in b?h&&h(b):f&&f(b)}else f&&f(a)};a.send()}function w(b,h,f){var a,d="",g=m.createElement(b);if(g.canPlayType){for(a=0;a<h.length;a++)""!==g.canPlayType(b+"/"+f[a])&&(r[h[a]]=b+"/"+f[a],d+=(d?"|":"")+h[a]);return d?new RegExp("^([^\\\\\\?\\s<>\"'&]+\\.)("+d+")$","i"):!1}return!1}function n(b,h,f,a,d){f=f||{};a=a||{};var g,c="video"===h||"audio"===h;h=m.createElement(h);for(var e in f)f.hasOwnProperty(e)&&("style"==e?h.style.cssText=f[e]:h.setAttribute(e,f[e]));c&&(g=m.createElement("source"));for(e in a)a.hasOwnProperty(e)&&(c?g.setAttribute(e,a[e]):(g=m.createElement("param"),g.setAttribute("name",e),g.setAttribute("value",a[e]),h.appendChild(g)));c&&h.appendChild(g);if(!d)return b.appendChild(h);f=b.parentNode;return(b=b.nextSibling)?f.insertBefore(h,b):f.appendChild(h)}function p(b){return 0===b%1&&9<b?2:"string"===typeof b&&/^(?:100|[1-9]\d(?:\.\d{1,2})?)%$/.test(b)?1:0}function e(b,e,f){if(e.i)var a="i";else if(e.v)a="v";else if(e.a)a="a";else if(C)a="o";else return!1;var d=e[a][0];e=e[a][1]||{};switch(a){case "i":var g="iframe";d.frameborder="0";d.scrolling="no";d.allowfullscreen||(d.allowfullscreen="allowfullscreen");break;case "v":g="video";break;case "a":g="audio";break;case "o":g="object";d.type="application/x-shockwave-flash";e.wmode="transparent";break;default:return!1}f=f||{};f.wt=f.wt||640;f.ht=f.ht||360;var c=p(f.wt);var h=p(f.ht);if(1===c&&2===h)d.style="width:100%;height:"+f.ht+"px;",c={style:"padding-top:5px;overflow:hidden;position:relative;width:"+f.wt+";"},f={style:"height:"+f.ht+"px;overflow:hidden;position:relative;"};else if(0<c&&0<h)d.style="position:absolute;left:0;top:0;width:100%;height:100%;",c={style:"padding-top:5px;overflow:hidden;position:relative;"+(1===c?"width:"+f.wt+";":"max-width:"+f.wt+"px;")},f={style:"overflow:hidden;position:relative;height:0;padding-bottom:"+(1===h?f.ht:100*f.ht/f.wt+"%;")};else return!1;++q;d.id="mediajs"+q;b.classList.add("mediajslink");b=n(n(b,"div",c,{},!0),"div",f);if(D&&"o"==a){g=a="";for(var k in d)d.hasOwnProperty(k)&&("data"==k?e.movie=d[k]:"type"!=k&&(a+=" "+k+'="'+d[k]+'"'));for(k in e)e.hasOwnProperty(k)&&(g+='<param name="'+k+'" value="'+e[k]+'" />');d=m.createElement("div");d.innerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+a+">"+g+"</object>";k=d.firstChild;d.removeChild(k);b.appendChild(k)}else x?(b.classList.add("mediajslazy"),b.setAttribute("data-lazyid",q),y[q]={type:g,attr:d,param:e},t||(t=new IntersectionObserver(function(a,b){a.forEach(function(a){if(a.isIntersecting){a=a.target;var c=y[a.dataset.lazyid];n(a,c.type,c.attr,c.param);a.classList.remove("mediajslazy");b.unobserve(a)}})})),t.observe(b)):n(b,g,d,e);return!0}function E(b){return/^\d+$/.test(b)?b:(b=b.match(/^((\d{1,2})h)?((\d{1,2})m)?((\d{1,2})s)?$/))?3600*(b[2]||0)+60*(b[4]||0)+1*(b[6]||0):""}function F(b,e){"z"!=e&&(b=Math.log(704E5/b)/Math.log(2));return Math.min(18,Math.max(Math.round(b),3))}function G(b){function h(a,b,c){e(a,{i:[{src:"https://w.soundcloud.com/player/?sharing=false&liking=false&show_playcount=false&show_comments=false&url=https%3A//"+b}]},c||{wt:"100%",ht:/\/playlists\//.test(b)?450:166})}var f=b.href,a=f.match(/^(.+)(?:#|%23)(\d+(?:\.\d{1,2})?)(%|%25)?(?::|%3A)(\d+(?:\.\d{1,2})?)(%|%25)?$/),d;if(a){b.href=f=a[1];var g=a[2]+(a[3]?"%":"");var c=a[4]+(a[5]?"%":"");0<p(g)&&0<p(c)&&(d={wt:g,ht:c})}(a=f.split("re.php?u="))&&a[1]&&(f=decodeURIComponent(a[1]).replace(/(https?|ftp)___/g,"$1://"));f=f.replace(/&amp;/g,"&");if(g=f.match(/^(https?:\/\/)(www\.)?(.+)$/))if(c=g[3],g[4]="https:"==m.location.protocol?"https://":g[1],a=c.match(/^(?:[a-z\d-]+\.)?youtu(?:be(?:-nocookie)?\.com|\.be)\/(?:playlist|(?:(?:.*?[\?&]v=)?([\w-]{11})(?:\?|&|#|$)))/)){var l=["wmode=transparent"],k=[];f="https://www.youtube.com/embed";if(a[1]){f+="/"+a[1];var n="start t end list rel loop".split(" ")}else l.push("listType=playlist"),n=["list","index","loop"],k=["list"];for(g=c.split(/[\?&#]/);c=g.shift();)c=c.split("="),c[0]&&c[1]&&-1<n.indexOf(c[0])&&/^[\w-]+$/.test(c[1])&&("start"==c[0]||"t"==c[0]||"end"==c[0]?l.push(("end"==c[0]?"end":"start")+"="+E(c[1])):(l.push(c[0]+"="+c[1]),"loop"==c[0]&&"1"==c[1]&&a[1]&&l.push("playlist="+a[1])),c=k.indexOf(c[0]),-1<c&&k.splice(c,1));k.length||e(b,{i:[{src:f+"?"+l.join("&")}]},d)}else(a=c.match(/^(?:player\.)?vimeo\.com\/(?:video\/)?(\d+)/))?e(b,{i:[{src:g[4]+"player.vimeo.com/video/"+a[1]}]},d):(a=c.match(/^dai(?:lymotion\.com\/video|\.ly)\/([a-zA-Z\d]+)/))?e(b,{i:[{src:g[4]+"www.dailymotion.com/embed/video/"+a[1]+'?theme=none"'}]},d):(a=c.match(/^rutube\.ru\/tracks\/(?:\d+)\.html\?v=([a-zA-Z\d]+)/))?e(b,{o:[{data:g[4]+"video.rutube.ru/"+a[1]},{allowFullScreen:"true",allowScriptAccess:"always"}]},d):(a=c.match(/^(?:rutube\.ru\/video\/embed|video\.rutube\.ru)\/(\d+)/))?e(b,{i:[{src:g[4]+"rutube.ru/video/embed/"+a[1]}]},d):(a=c.match(/^rutube\.ru\/video\/([a-zA-Z\d]+)/))?e(b,{i:[{src:g[4]+"rutube.ru/video/embed/"+a[1]}]},d):(a=c.match(/^api\.soundcloud\.com\/(?:tracks|playlists)\/\d+/))?h(b,a[0],d):(a=c.match(/^soundcloud\.com\/[\w-]+\/(?:sets\/)?[\w-]+/))?v("https://soundcloud.com/oembed?format=json&url=https%3A//"+a[0],function(a){(a.m=a.html.replace(/%2F/g,"/").match(/api\.soundcloud\.com\/(?:tracks|playlists)\/\d+/))&&h(b,a.m[0],d)}):(a=c.match(/^(www\d+)\.zippyshare\.com\/v\/(\w+)\//))?e(b,{i:[{src:g[4]+"api.zippyshare.com/api/jplayer_embed.jsp?key="+a[2]+"&server="+a[1]+"&width=100%"}]},d||{wt:"100%",ht:92}):(a=c.match(/^www(\d+)\.zippyshare\.com\/v(?:\/|.*?key=)(\d+)/))?e(b,{o:[{data:"http://www"+a[1]+".zippyshare.com/swf/player_local.swf?file="+a[2]+"&server="+a[1]+"&baseurl=http://www.zippyshare.com/api/&flashid=null&autostart=false&availablequality=both"},{allowScriptAccess:"always",allowFullScreen:"false"}]},d||{wt:"100%",ht:80}):(a=c.match(/^metacafe\.com\/(?:watch|embed)\/(\d+)/))?e(b,{i:[{src:"http://www.metacafe.com/embed/"+a[1]+"/"}]},d):(a=c.match(/^video\.sibnet\.ru\/[^\?&]*?video(\d+)/))?e(b,{i:[{src:g[4]+"video.sibnet.ru/shell.php?videoid="+a[1]+"/"}]},d):(a=c.match(/^promodj\.com\/(?:[^\/]+\/[^\/]+|download|embed)\/(\d+)/))?e(b,{i:[{src:g[4]+"promodj.com/embed/"+a[1]+"/big"}]},d||{wt:"100%",ht:70}):(a=c.match(/^(?:[a-z]{1,3}\.)?(ign\.com\/videos\/\d{4}\/\d{1,2}\/\d{1,2}\/[\w-]+)/))?e(b,{i:[{src:g[4]+"widgets.ign.com/video/embed/content.html?url=https://www."+a[1]}]},d):(a=c.match(/^(?:[a-z]{1,3}\.)?twitch\.tv\/\w+\/v\/(\d+)/))?e(b,{i:[{src:"https://player.twitch.tv/?autoplay=false&video=v"+a[1]}]},d):(a=c.match(/^(?:[a-z]{1,3}\.)?twitch\.tv\/(?!(?:directory|login|store|jobs)\b)(\w+)$/))?e(b,{i:[{src:"https://player.twitch.tv/?autoplay=false&channel="+a[1]}]},d):(a=c.match(/^([a-z]{1,}\.)?gamespot\.com\/(?:video(?:s|embed)?|[\w\/-]+\/videos?)(?=\/)[^\?&#]*[\/-](\d{7,})\//))?(c=c.split("?"),c=c[1]?c[1].replace(/&?autoplay=[^&]*/g,"").replace(/^&/,""):!1,e(b,{i:[{src:"https://www.gamespot.com/videos/embed/"+a[2]+"/"+(c?"?"+c:"")}]},d)):z&&(a=c.match(z))?e(b,{a:[{controls:!0,preload:"metadata",controlsList:"nodownload"},{src:g[1]+(g[2]?g[2]:"")+a[1]+a[2],type:r[a[2]]}]},d||{wt:"100%",ht:50}):A&&(a=c.match(A))?e(b,{v:[{controls:!0,preload:"metadata",controlsList:"nodownload"},{src:g[1]+(g[2]?g[2]:"")+a[1]+a[2],type:r[a[2]]}]},d):(a=c.match(/^([^\\\?\s<>"'&]+\.mp3)$/))?e(b,{o:[{data:B+"swf/mp3player.swf"},{FlashVars:"soundFile="+f,quality:"high",menu:"false"}]},{wt:"100%",ht:24}):(a=c.match(/^hu(?:\.lk\/|lkshare\.com\/(?:.*?fn=)?)([a-z\d]{12})(?:$|[^a-z\d])/))?e(b,{i:[{src:g[4]+"www.hulkshare.com/embed.php?fn="+a[1]}]},d||{wt:"100%",ht:160}):(a=c.match(/^(mixcloud\.com\/(?!(categories|competitions|projects|developers|tag)\/)[\w-]+\/(?!(listens|favorites|activity|messages|following)\/)[\w-]+\/)$/))?e(b,{i:[{src:g[4]+"www.mixcloud.com/widget/iframe/?hide_artwork=1&embed_type=widget_standard&hide_tracklist=1&feed=http://www."+a[1]}]},d||{wt:"100%",ht:120}):(a=c.match(/^(vk\.com\/video_ext\.php\?oid=[\d-]+&id=[\d-]+&hash=\w+(&sd|&hd=1|&hd=2)?)/))?e(b,{i:[{src:g[4]+a[1]}]},d):(a=c.match(/^coub\.com\/view\/([a-zA-Z\d]+)/))?e(b,{i:[{src:g[4]+"coub.com/embed/"+a[1]+"?muted=false&autostart=false&originalSize=false"}]},d):(a=c.match(/^vine\.co\/v\/([a-zA-Z\d]+)/))?e(b,{i:[{src:"https://vine.co/v/"+a[1]+"/embed/simple"}]},d||{wt:360,ht:360}):(a=c.match(/^(?:[a-z\d-]+\.)?facebook\.com.*?\/(?:photo\.php|video\.php|embed|videos\/(?:vb\.\d+\/)?)(?:.*?[\?&]v(?:ideo_id)?=)?(\d+)(?=\/|&|$)/))?e(b,{i:[{src:"https://www.facebook.com/video/embed?video_id="+a[1]}]},d):(a=c.match(/^(?=[^\/]*\byandex\.(com|ru|ua)\/)(?=[^\?&]*\bmaps\b).+\/\-\/([\w~\-]+)$/))?e(b,{i:[{src:"https://api-maps.yandex."+a[1]+"/frame/v1/-/"+a[2]}]},d||{wt:410,ht:350}):(a=c.match(/^maps\.google\.((?:com?\.)?[a-z]{2,3})\/([a-z\d\?\.,&=]+)$/))?e(b,{i:[{src:("cn"==a[1]?"http://maps.google."+a[1]:"https://maps.google.com")+"/"+a[2]+"&ie=UTF8&output=embed"}]},d||{wt:410,ht:350}):(a=c.match(/^google\.((?:com?\.)?[a-z]{2,3})\/maps\/embed\?pb=([^\s\?<>,&]+)$/))?e(b,{i:[{src:("cn"==a[1]?"http://www.google."+a[1]:"https://www.google.com")+"/maps/embed?pb="+a[2]}]},d||{wt:410,ht:350}):(a=c.match(/^google\.((?:com?\.)?[a-z]{2,3})\/maps\/(?:place\/([^\/<>\[\]\?&]+))?[^\?&]*@(-?\d+\.\d+),(-?\d+\.\d+),(\d+(?:\.\d+)?)([zm])/))?e(b,{i:[{src:("cn"==a[1]?"http://maps.google."+a[1]:"https://maps.google.com")+"/?ll="+a[3]+","+a[4]+"&t="+("z"==a[6]?"m":"h")+"&z="+F(a[5],a[6])+(a[2]?"&q="+a[2]:"")+"&ie=UTF8&output=embed"}]},d||{wt:410,ht:350}):(a=c.match(/^ok\.ru\/video(?:embed)?\/(\d+)/))?e(b,{i:[{src:"https://ok.ru/videoembed/"+a[1]}]},d):(a=c.match(/^liveleak\.com\/(?:view|ll_embed)\?([a-z])=(\w+)/))?e(b,{i:[{src:g[4]+"www.liveleak.com/ll_embed?"+a[1]+"="+a[2]}]},d):(a=c.match(/^video\.online\.ua\/(?:embed\/)?(\d+)\//))?e(b,{i:[{src:g[4]+"video.online.ua/embed/"+a[1]+"/"}]},d):(a=c.match(/^aparat\.com\/(?:v|embed)\/(\w+)/))?e(b,{i:[{src:"https://www.aparat.com/video/video/embed/videohash/"+a[1]+"/vt/frame"}]},d):(a=c.match(/^audiomack\.com\/(?:embed\/)?song\/([\w-]+\/[\w-]+)/))?e(b,{i:[{src:"https://audiomack.com/embed/song/"+a[1]+"?background=1"}]},d||{wt:"100%",ht:252}):(a=c.match(/^audiomack\.com\/(?:embed\/)?playlist\/([\w-]+\/[\w-]+)/))?e(b,{i:[{src:"https://audiomack.com/embed/playlist/"+a[1]+"?background=1"}]},d||{wt:"100%",ht:400}):(a=c.match(/^dumpert\.nl\/(?:mediabase|embed)(\/\d+\/[\dabcdef]+\/)/))?e(b,{i:[{src:"https://www.dumpert.nl/embed"+a[1]}]},d):(a=c.match(/^izlesene\.com\/(?:embedplayer|video\/[^\/]+)\/(\d+)/))?e(b,{i:[{src:"https://www.izlesene.com/embedplayer/"+a[1]+"/?showrel=0&loop=0&autoplay=0&autohide=1&showinfo=1&socialbuttons=1&annotation=&volume=0.5"}]},d):(a=c.match(/^hearthis\.at\/(?!(?:categories|maps)\/)[\w\.-]+\/(?:set\/)?[\w\.-]+\//))?v("https://hearthis.at/oembed/?format=json&url=https%3A//"+a[0],function(a){(a.m=a.html.match(/<iframe [^>]*?src=["']([^"'<>]+)["']/))&&e(b,{i:[{src:a.m[1]}]},d||{wt:a.width,ht:a.height})}):(a=c.match(/^(?:vlp\.to\/|vlipsy\.com\/(?:vlip\/[\w-]+-|embed\/))([a-zA-Z\d]{8})$/))&&e(b,{i:[{src:"https://vlipsy.com/embed/"+a[1]}]},d)}var q=0,B="",r={},D=!!u.ActiveXObject,C=function(){if(l.plugins&&l.plugins.length&&l.mimeTypes&&l.mimeTypes["application/x-shockwave-flash"]&&l.mimeTypes["application/x-shockwave-flash"].enabledPlugin)return!0;try{return new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),!0}catch(b){}return!1}(),z=w("audio","mp3 m4a ogg oga webma wav".split(" "),"mpeg mp4 ogg ogg webm wav".split(" ")),A=w("video",["mp4","m4v","ogv","webm","webmv"],["mp4","mp4","ogg","webm","webm"]),x=!1,y=[],t;return{run:function(){var b;if((b=m.querySelectorAll("#brd-main .entry-content"))&&b.length)B=PUNBB.env.sva_mediajs.url_swf+"/";else if(!(b=m.querySelectorAll(".postmsg"))||!b.length)return;"IntersectionObserver"in u&&!/Googlebot|YandexBot/.test(l.userAgent)&&(x=!0);for(var e in b)if(b[e].className&&!b[e].classList.contains("postsignature")){var f=b[e].getElementsByTagName("a"),a;for(a in f)if(f[a].href&&(!f[a].nextSibling||f[a].nextSibling.tagName&&"BR"==f[a].nextSibling.tagName.toUpperCase())&&(!f[a].previousSibling||f[a].previousSibling.tagName&&"BR"==f[a].previousSibling.tagName.toUpperCase())&&"P"==f[a].parentNode.tagName.toUpperCase()&&!/<(p|a|img|ul|ol)/i.test(f[a].innerHTML)){for(var d=f[a].parentNode;d!==b[e]&&"BLOCKQUOTE"!==d.tagName.toUpperCase();)d=d.parentNode;d===b[e]&&G(f[a])}}},init:function(){m.addEventListener&&"undefined"!==typeof DOMTokenList&&m.addEventListener("DOMContentLoaded",FluxBB.media.run(),!1)}}}(document,window,navigator);FluxBB.media.init();
